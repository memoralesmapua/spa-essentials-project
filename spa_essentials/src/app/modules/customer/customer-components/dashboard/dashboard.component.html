<div style="display:flex; gap:24px; align-items:flex-start; flex-wrap:wrap;">
  <div style="flex:1; min-width: 300px;">
    <h2>Browse Categories</h2>
    <div *ngFor="let c of categories" style="background:#fff; padding:12px; border-radius:8px; margin-bottom:12px; box-shadow: 0 1px 3px rgba(0,0,0,0.08);">
      <div style="display:flex; gap:12px; align-items:center;">
        <img [src]="c.processedImg" alt="category" style="width:80px; height:60px; object-fit:cover; border-radius:6px;"/>
        <div>
          <div style="font-weight:600;">{{c.name}}</div>
          <div style="font-size:12px; color:#666;">{{c.description}}</div>
          <div style="font-size:12px; color:#111; margin-top:4px;">Price: {{c.price | currency}}</div>
          <div style="margin-top:8px; display:flex; gap:8px;">
            <button nz-button nzType="default" (click)="addCategoryToCart(c)">Add to Cart</button>
            <button nz-button nzType="primary" (click)="buyCategory(c)">Buy Now</button>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="selectedCategoryId">
      <h3 style="margin-top:16px;">Products</h3>
      <div style="display:grid; grid-template-columns: repeat(auto-fill, minmax(220px,1fr)); gap:12px;">
        <div *ngFor="let p of products" style="background:#fff; padding:12px; border-radius:8px; box-shadow:0 1px 3px rgba(0,0,0,0.08);">
          <img [src]="p.processedImg" alt="product" style="width:100%; height:120px; object-fit:cover; border-radius:6px;"/>
          <div style="font-weight:600; margin-top:8px;">{{p.name}}</div>
          <div style="font-size:12px; color:#666;">{{p.description}}</div>
          <div style="margin:8px 0;">{{p.price | currency}}</div>
          <button nz-button nzType="primary" (click)="addToCart(p)">Add to Cart</button>

          <div style="margin-top:12px;">
            <div style="font-weight:600; margin-bottom:6px;">Reviews</div>
            <div *ngIf="(productReviews[p.id] || []).length === 0" style="font-size:12px; color:#666;">No reviews yet.</div>
            <div *ngFor="let r of productReviews[p.id]" style="font-size:12px; margin:6px 0; padding:6px; background:#fafafa; border-radius:6px;">
              <div>Rating: {{r.rating}}/5</div>
              <div style="color:#555;">{{r.comment}}</div>
              <div style="color:#999; font-size:11px;">{{r.createdAt | date:'short'}}</div>
            </div>

            <div style="margin-top:8px; display:flex; gap:6px; align-items:center;">
              <input nz-input type="number" min="1" max="5" placeholder="Rating (1-5)"
                     [(ngModel)]="reviewDraft[p.id].rating" (ngModelChange)="reviewDraft[p.id] = reviewDraft[p.id] || {rating: 0, comment: ''}" style="width: 110px;" />
              <input nz-input placeholder="Write a review"
                     [(ngModel)]="reviewDraft[p.id].comment" (ngModelChange)="reviewDraft[p.id] = reviewDraft[p.id] || {rating: 0, comment: ''}" />
              <button nz-button nzType="default" (click)="submitReview(p.id)">Submit</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div style="width:340px; background:#fff; padding:16px; border-radius:8px; box-shadow:0 1px 3px rgba(0,0,0,0.08);">
    <h3>Your Cart</h3>
    <div *ngIf="cartItems.length === 0" style="color:#666;">Cart is empty</div>
    <div *ngFor="let item of cartItems" style="display:flex; gap:10px; align-items:center; margin:10px 0;">
      <img [src]="item.processedImg" alt="item" style="width:60px; height:45px; object-fit:cover; border-radius:4px;"/>
      <div style="flex:1;">
        <div style="font-weight:600;">{{item.name}}</div>
        <div style="font-size:12px; color:#666;">Qty: {{item.quantity}}</div>
        <div>{{item.price | currency}}</div>
      </div>
      <button nz-button nzType="default" nzDanger (click)="removeFromCart(item.id)">Remove</button>
    </div>
    <hr>
    <div style="display:flex; justify-content:space-between; font-weight:600;">
      <span>Total</span>
      <span>{{ cartTotal() | currency }}</span>
    </div>
    <button nz-button nzType="primary" style="width:100%; margin-top:12px;" [disabled]="cartItems.length===0" (click)="checkout()">Buy Now</button>
  </div>
</div>
